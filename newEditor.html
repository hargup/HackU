<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Keyboard</title>
  </head>
  <body>
    <ul id="mods"></ul>
    <div id="bind"></div>
    <textarea onclick="test_fun()"></textarea>
    <script src="Keyboard.js"></script>


<script>
var keyboard = new Keyboard(window);

var activeElem = document.activeElement;
var keyPress = function(){
var key = "";
keyboard.on('*', function(e){
key = e.name;
//console.log(key);
activeElem.value = key;
});
return key;
}

var text = "";
var keyPressed = "";
var escapeSequence = ["Escape","Ctrl+C"];
var area=document.getElementsByTagName("textarea")[0];
var insertMode = false;
var insertKeys = ["I"];
var navigationKeys = {
	up:"k",
	down:"j",
	left:"h",
	right:"l"
};

/************** Function definitions ******************/
var search = function(toSearch, Area, Coursor_pos ) {//search and highlight text
	var pos = Area.value.slice(Coursor_pos).search(toSearch);

	var initial_pos =Coursor_pos + pos
	var end_pos = initial_pos + toSearch.length;
	area.setSelectionRange(initial_pos, end_pos);
	str_len = end_pos - initial_pos;
	if(pos == 0)
	{
		initial_pos = Area.value.search(toSearch);
		end_pos = initial_pos + toSearch.length;
	}
	return end_pos ;
};	

function doGetCaretPosition (ctrl) {
var CaretPos = 0;	// IE Support
if (document.selection) {
ctrl.focus ();
var Sel = document.selection.createRange ();
Sel.moveStart ('character', -ctrl.value.length);
CaretPos = Sel.text.length;
}
// Firefox support
else if (ctrl.selectionStart || ctrl.selectionStart == '0')
CaretPos = ctrl.selectionStart;
return (CaretPos);
}
function setCaretPosition(ctrl, pos){
if(ctrl.setSelectionRange)
{
ctrl.focus();
ctrl.setSelectionRange(pos,pos);
}
else if (ctrl.createTextRange) {
var range = ctrl.createTextRange();
range.collapse(true);
range.moveEnd('character', pos);
range.moveStart('character', pos);
range.select();
}
}

function setCaretPosition(elemId, caretPos) {
    var elem = document.getElementById(elemId);

    if(elem != null) {
        if(elem.createTextRange) {
            var range = elem.createTextRange();
            range.move('character', caretPos);
            range.select();
        }
        else {
            if(elem.selectionStart) {
                elem.focus();
                elem.setSelectionRange(caretPos, caretPos);
            }
            else
                elem.focus();
        }
    }
}

var replaceChar = function(replace_with, Area, Coursor_pos){
	text = Area.value;
	before = text.slice(0, Coursor_pos);
	after = text.slice(Coursor_pos + 1);
	text = before + replace_with + after;
	Area.value = text;
       return text.length;	
};

function navUp(Area,Coursor_pos)
{
	var width = Area.cols;
	console.log(width);
	pos = Coursor_pos - width;
	setCaretPosition(area, pos);
	console.log("navUp pos:" + pos);
	return pos;
}

//function navDown
function isAlphaNum(character)
{
	var anum = /^[a-zA-Z0-9]$/
	var ValidChars = "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ01234567890";
	for(var i = 0; i<ValidChars.length; i++)
	{
		if(character == ValidChars[i])
		{
			return 1;
		}
	}
	if ( character.search(anum))
	{
		return 1;
	}
	return -1;
}

function test_fun()
{
	pos = doGetCaretPosition(area);
	console.log("test_fun pos:" + pos );
	navUp(area,pos);
	console.log("test_fun pos after navUp:" + pos );
}

/************* Function definitions end ***************/
/*******Testing code**********/
console.log(isAlphaNum('a'));
area.value =  "This value has a value: Yahoo HackU This has so many characteres. OOPS characters Yes I'll complete the hack! Yes I'll complete the hack!";
//search("has", area, 0);
//replaceChar( 'x', area, 3);
console.log(keyPress());
setCaretPosition(area, 8);
alert(doGetCaretPosition(area));
</script>
  </body>
</html>
